-- This generates a cylinder using Voronoi tessellation.

deg_to_rad = math.pi / 180.0

-- When tilted, this cylinder has a degeneracy problem, failing the test at 
-- TetgenGenerator.cpp, line 901.
--cyl_points = point_factory.cylinder{radius = 1, length = 10, nr = 2, nz = 2, 
--                                    radial_spacing = 'log', log_spacing_factor = 1.3}

-- When tilted, this cylinder has a degeneracy problem, generating a tet with 0 volume.
--cyl_points = point_factory.cylinder{radius = 1, length = 10, nr = 3, nz = 3, 
--                                    radial_spacing = 'log', log_spacing_factor = 1.3}

-- When tilted, this cylinder has a degeneracy problem, producing a zero determinant in 
-- the circumsphere calculation.
cyl_points = point_factory.cylinder{radius = 1, length = 10, nr = 8, nz = 60, 
                                    radial_spacing = 'log', log_spacing_factor = 1.3}

--write_gnuplot_points(cyl_points, 'cylinder')
--rotate_points(cyl_points, 5.0 * deg_to_rad, {1, 0, 0})
--write_gnuplot_points(cyl_points, 'cylinder1')
box = bounding_box{x1 = -2, x2 = 2, y1 = -2, y2 = 2, z1 = -5, z2 = 5}
lat_points = point_factory.cubic_lattice{bounding_box = box, nx = 20, ny = 20, nz = 60}
--rotate_points(lat_points, 45 * deg_to_rad, {1, 0, 0})
num_removed = remove_points(lat_points, {near_points = cyl_points, within_distance=0.1})
--print(num_removed)

mesh = mesh_factory.voronoi(cyl_points .. lat_points, box)
print(mesh)
write_silo_plot(mesh, 'cylinder')
